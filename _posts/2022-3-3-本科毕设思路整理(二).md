---
layout: post
author: shopkeeper
categories: thesis gis
---

## beidou-grid-location-codec

- v1.1.5 -> v1.1.6

- 修改`获取邻接网格`接口，用于适配圆形搜索：可以指定获取的邻接网格位置。

- 添加新功能：获取两同级网格之间的所有网格编码，用于适配矩形框搜索、获取一网格的大小。

## 空间数据关联模型

新增地名节点，主要是从城市限定空间进行搜索，例如“搜索武汉市下有哪些酒店”。

### 地名节点

地名节点有三个属性：

- `name`：地名，如“湖北省”、“武汉市”、“洪山区”

- `level`：行政区等级，分为三级，省、市、县(区)

- `type`：所有地名节点的type字段都是`areaNode`

各个行政区之间有`管辖`关系，例如
```
(湖北省)-[管辖]->(武汉市)-[管辖]->(洪山区)
```

地名节点与空间编码节点有`覆盖`关系。

根据不同层级网格的大小，我对这种关系根据层级进行了映射。下表是1~4级北斗网格在赤道处的大小。

| 级别 | 单元大小 | 网格数量（相对上一级） | 网格大小（赤道处）
  | :---: | :---: | :---: | :---: |
  | 第一级 | 6°×4° | 60×22×2 | 667.92km×445.28km |
  | 第二级 | 30′×30′ | 12×8 | 55.66km×55.66km |
  | 第三级 | 15′×10′ | 2×3 | 27.83km×18.55km |
  | 第四级 | 1′×1′ | 15×10 | 1.85km×1.85km |

由此制定的映射关系为

- `省`级地名节点只与`第一级`空间编码节点关联

- `市`级地名节点只与`第二级`空间编码节点关联

- `县`级地名节点只与`第三级`空间编码节点关联

例如湖北省所`覆盖`的空间编码节点为`N49H``N50H`

部分地名节点-空间编码节点图数据库关联如下：

![](/assets/images/2022-3-3-本科毕设思路整理(二)-1.png)

可见地名节点与空间编码节点的关系是多对多关系。

## 城市搜索

当使用城市搜索时，实现的是仅仅搜索目标城市下的POI。由于地名节点与空间编码节点关联，因此本质上是确定目标城市的地名节点，从而取得其关联的所有空间编码节点再进行搜索。

由于地名节点与空间编码节点是多对多关系，即一个地名节点可能对应多个空间编码节点（需要搜索所有的空间编码节点），一个空间编码节点可能对应多个地名节点（需要对搜索结果进行筛选）。由此可得，搜索过程为

1. 根据目标城市找到地名节点

2. 根据地名节点找到所有覆盖的空间编码节点

3. 对空间编码节点进行路径遍历找到所有POI节点

4. 根据查询条件(name、type)对POI节点进行第一遍筛选

5. 对第一遍筛选的结果进行地点筛选，这一步是保证所得结果均在目标城市范围内

## 数据处理

原始的POI数据中没有行政区的信息，需要对每一条POI节点分别处理生成其省市县列。

![](/assets/images/2022-3-3-本科毕设思路整理(二)-2.png)

### 第一遍，获取省市县列

- 对于规范的address字段(xx省xx市xx县(区))，采用字符串分割的方式获取省市县字段。

- 对于不规范的address字段，如上图中第二条address=`同新路9号`，需要根据其wgs-84坐标系经纬度，先转化成GCJ-02坐标系经纬度，再使用高德地理编码服务获取省市县数据。

### 第二遍，检验省市县列

实际上，存在大量POI的address字段，即便满足`xx省xx市xx县(区)`的格式，但是仍然是错误的，例如某某开发区，其对应的并不是所在地行政区名称，或者直接是错误的行政区名称。

![](/assets/images/2022-3-3-本科毕设思路整理(二)-3.png)

需要对每一条POI的省市县行进行判断，是否是合法的行政区名称，如果非法，则进行第一遍的第二步。